/*
soma-template - v0.3.2 - 2015-03-03
http://soundstep.github.com/soma-template/
http://www.soundstep.com
MIT licence 2015
*/
!function(a){"use strict";function b(a){return"[object Array]"===Object.prototype.toString.apply(a)}function c(a){return"object"==typeof a}function d(a){return"string"==typeof a}function e(a){return a?a.nodeType>0:!1}function f(a){return a&&a.nodeType&&3===a.nodeType}function g(a){return a&&"function"==typeof a}function h(a){return null!==a&&void 0!==a}function i(a){return h(a)?"true"===a||"1"===a||a===!0||1===a?!0:"false"===a||"0"===a||a===!1||0===a||d(a)&&I(a)?!1:!!a:!1}function j(a){return a&&g(a.toString)&&"[object Expression]"===a.toString()}function k(a){return d(a)?!!a.match(tb.func):!1}function l(a){return a&&a.parent&&Bb.get(a.element)}function m(a){return a.replace(tb.escape,"\\$&")}function n(a,b){var c=lb.start().replace(/\\/g,""),d="",e=b?a:c;e.length>1&&(d="|\\"+e.substr(0,1)+"(?!\\"+e.substr(1,1)+")[^"+e.substr(0,1)+"]*"),tb.sequence=new RegExp(lb.start()+".+?"+lb.end()+"|[^"+lb.start()+"]+"+d,"g"),tb.token=new RegExp(lb.start()+".*?"+lb.end(),"g"),tb.expression=new RegExp(lb.start()+"|"+lb.end(),"gm")}function o(a){return a.replace(tb.trim,"")}function p(a){return tb.string.test(a)?a.substr(1,a.length-2):a}function q(a){return""===a[0]&&a.shift(),""===a[a.length-1]&&a.pop(),a}function r(a){return a.replace(tb.expression,"")}function s(a){return a.replace(tb.depth,"")}function t(a,b){a.parentNode&&a.parentNode.insertBefore(b,a)}function u(a,b){a.parentNode&&a.parentNode.insertBefore(b,a.nextSibling)}function v(a,b){var c;(c="object"==typeof document&&document.documentElement.classList?function(a,b){a.classList.remove(b)}:function(a,b){if(!a||!a.className)return!1;var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c,"$2")})(a,b)}function w(a){function b(){return++e+a}function c(c){if(c){if("object"!=typeof c)return c;var d;try{d=c[a]?c[a]:c[a]=b()}catch(e){}return d}}var d={},e=0;this.remove=function(a){delete d[c(a)]},this.get=function(a){return d[c(a)]},this.put=function(a,b){d[c(a)]=b},this.has=function(a){return"undefined"!=typeof d[c(a)]},this.getData=function(){return d},this.dispose=function(){for(var a in d)d.hasOwnProperty(a)&&delete d[a];this.length=0}}function x(a,b){var c=a.match(tb.repeat);if(c){var d=c[2],e=new Ab(d);return e.getValue(b)}}function y(a,b,c){var d=a.match(tb.repeat);if(d){var e=d[1];b[e]=c}}function z(a,b){var c=a.node||a.attribute.node,d=c.template.watchers,e=c.element;if(!d)return b;var i=d.get(e);!i&&f(c.element)&&c.parent&&(i=d.get(c.parent.element));var j=i?i:d.get(a.pattern);if(g(j)){var k=j(a.value,b,a.pattern,c.scope,c,a.attribute);if(h(k))return k}return b}function A(a,b){for(var c=F(b),d=a;c>0;)d=d._parent?d._parent:d,c--;return d}function B(a,b,c){var d=new Ab(b);return C(a,d.pattern,d.path,d.params,void 0,void 0,void 0,c)}function C(a,b,c,d,e,f,i,j){if(b===nb.element)return j[nb.element];if(b===nb.parentElement)return j[nb.parentElement];if(b===nb.attribute)return j[nb.attribute];if(b===nb.scope)return j[nb.scope];if(tb.string.test(b))return p(b);if(!isNaN(b))return+b;var k=[];if(!i&&d)for(var l=0,m=d.length;m>l;l++)k.push(B(a,d[l],j));else k=i;if(f)return k;var n=A(a,b);if(b=b.replace(/..\//g,""),c=c.replace(/..\//g,""),!n)return void 0;var o=n,q=c.split(/\.|\[|\]/g);if(q.length>0)for(var r=0,s=q.length;s>r;r++)if(""!==q[r]&&(o=o[q[r]]),!h(o))return n._parent?C(n._parent,b,c,d,e,f,k):void 0;return g(o)?e?o:o.apply(null,k):o}function D(a){var b=a.split("(")[0];return b=s(b)}function E(a){return q(a.split(tb.params))}function F(a){var b=a.split("(")[0],c=b.match(tb.depth);return c?c.length:0}function G(a,b,c){var d;return a.attributes=a.attributes||[],b===kb.attributes.skip&&(a.skip=i(c)),b===kb.attributes.html&&(a.html=i(c)),b!==kb.attributes.repeat||a.isRepeaterDescendant||(a.repeater=c),(I(b+":"+c)||b===kb.attributes.repeat||b===kb.attributes.skip||b===kb.attributes.html||b===kb.attributes.show||b===kb.attributes.hide||b===kb.attributes.href||b===kb.attributes.class||b===kb.attributes.checked||b===kb.attributes.disabled||b===kb.attributes.multiple||b===kb.attributes.readonly||b===kb.attributes.selected||-1!==c.indexOf(kb.attributes.cloak))&&(d=new yb(b,c,a),a.attributes.push(d)),ob[b]&&(d=new yb(b,c,a),a.attributes.push(d)),d}function H(a,b){var c=new xb(a,b);c.previousSibling=a.previousSibling,c.nextSibling=a.nextSibling;for(var d,e=[],f=a.attributes,g=0,h=f&&f.length;h>g;g++)if(d=f[g],d.specified||"value"===d.name){var i=G(c,d.name,d.value);ob[d.name]&&ob[d.name]&&!c.isRepeaterChild&&e.push({name:ob[d.name],value:d.value,attr:i})}for(var j=0,k=e.length;k>j;j++)c.addEvent(e[j].name,e[j].value,e[j].attr);return c}function I(a){var b=a.match(tb.token);return b&&b.length>0}function J(a){return tb.content.test(a)}function K(a){if(a){var b=a.nodeType;return a&&b?8===b?!1:3!==b||J(a.nodeValue)||I(a.nodeValue)?!0:!1:!1}}function L(a,b,c,d){if(K(b)){var e;if(d?(e=d,e.parent=c):e=H(b,c?c.scope:new wb(jb)._createChild()),c&&(c.repeater||c.isRepeaterChild)&&(e.isRepeaterChild=!0),e.template=a,!e.skip){for(var f=b.firstChild;f;){var g=L(a,f,e);g&&(g.parent=e,e.children.push(g)),f=f.nextSibling}return e}}}function M(a,b){N(a);for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function N(a){for(var b in a)a.hasOwnProperty(b)&&"_"!==b.substr(0,1)&&(a[b]=null,delete a[b])}function O(a){if(!a.repeater&&a.children&&!l(a))for(var b=0,c=a.children.length;c>b;b++)a.children[b].update()}function P(a){if(a.children&&!l(a))for(var b=0,c=a.children.length;c>b;b++)a.children[b].render()}function Q(a){var c,d=x(a.repeater,a.scope);if(b(d)){for(var e=0,f=d.length,g=a.childrenRepeater.length,h=f>g?f:g;h>e;e++)f>e?c=U(a,e,d[e],nb.index,e,c):(a.parent.element.removeChild(a.childrenRepeater[e].element),a.childrenRepeater[e].dispose());a.childrenRepeater.length>d.length&&(a.childrenRepeater.length=d.length)}else{var i=-1;for(var j in d)d.hasOwnProperty(j)&&(i++,c=U(a,i,d[j],nb.key,j,c));for(var k=i;i++<a.childrenRepeater.length-1;)a.parent.element.removeChild(a.childrenRepeater[i].element),a.childrenRepeater[i].dispose();a.childrenRepeater.length=k+1}a.element.parentNode&&a.element.parentNode.removeChild(a.element)}function R(a,b){if(K(b.element)){if(a.attributes)for(var c=0,d=a.attributes.length;d>c;c++){var e=a.attributes[c],f=G(b,e.name,e.value);ob[e.name]&&b.addEvent(ob[e.name],e.value,f)}for(var g=a.element.firstChild,h=b.element.firstChild;g&&h;){var i=a.getNode(g),j=new xb(h,b.scope);b.children.push(j),j.parent=b,j.template=b.template,j.isRepeaterChild=!0;var k=R(i,j);k&&(k.parent=j,k.template=j.template,j.children.push(k)),g=g.nextSibling,h=h.nextSibling}return j}}function S(a,b){var c=new xb(a,b.scope._createChild());return c.template=b.template,c.parent=b,c.isRepeaterChild=!0,c.isRepeaterDescendant=!0,R(b,c),c}function T(a,b,c){a?u(a,c):b.element.previousSibling?u(b.element.previousSibling,c):b.element.nextSibling?t(b.element.nextSibling,c):b.parent.element.appendChild(c)}function U(a,b,c,d,e,f){var g=a.childrenRepeater[b];if(g)return y(a.repeater,g.scope,c),g.scope[d]=e,g.update(),g.render(),g.element;var h=a.element.cloneNode(!0);T(f,a,h);var i=S(h,a);return a.childrenRepeater[b]=i,y(a.repeater,i.scope,c),i.scope[d]=e,i.update(),i.render(),h}function V(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else{c.$$guid||(c.$$guid=V.guid++),a.events||(a.events={});var d=a.events[b];d||(d=a.events[b]={},a["on"+b]&&(d[0]=a["on"+b])),d[c.$$guid]=c,a["on"+b]=function(a){var b=!0;a=a||X(((this.ownerDocument||this.document||this).parentWindow||window).event);var c=this.events[a.type];for(var d in c)c.hasOwnProperty(d)&&(this.$$handleEvent=c[d],this.$$handleEvent(a)===!1&&(b=!1));return b}}}function W(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.events&&a.events[b]&&delete a.events[b][c.$$guid]}function X(a){return a.preventDefault=X.preventDefault,a.stopPropagation=X.stopPropagation,a}function Y(a,b,c){Db=void 0===c?Number.MAX_VALUE:c,Z(a,b,0,!0)}function Z(a,b,c,d){if(!e(a))throw new Error("Error in soma.template.parseEvents, only a DOM Element can be parsed.");if(d&&$(a,b),0!==Db)for(var f=a.firstChild;f;)1===f.nodeType&&Db>c&&(Z(f,b,++c),$(f,b)),f=f.nextSibling}function $(a,b){for(var c,d,e,f=a.attributes,h=0,i=f&&f.length;i>h;h++)if(c=f[h],c.specified&&(d=c.name,e=c.value,ob[d])){var j=_(b,e);j&&g(j)&&(V(a,ob[d],j),Fb.push({element:a,type:ob[d],handler:j}))}}function _(a,b){var c=b.match(tb.func);if(c){var d=c[1];if(g(a[d]))return a[d]}}function ab(a){for(var b=Fb.length,c=0;--b>=c;){var d=Fb[b];(a===d.element||vb(a,d.element))&&(W(d.element,d.type,d.handler),Fb.splice(b,1))}}function bb(a,b,c){var d=cb(b);c(d,d.scope,d.element,d.node)}function cb(b,c){var f;if(d(b)){if(!e(c))throw new Error(a.template.errors.TEMPLATE_STRING_NO_ELEMENT);c.innerHTML=b,f=c}else{if(!e(b))throw new Error(a.template.errors.TEMPLATE_NO_PARAM);e(c)?(c.innerHTML=b.innerHTML,f=c):f=b}db(f)&&(db(f).dispose(),Bb.remove(f));var g=new Cb(f);return Bb.put(f,g),g}function db(a){return Bb.get(a)}function eb(){var a=Bb.getData();for(var b in Bb.getData())a.hasOwnProperty(b)&&Bb.get(b).render()}function fb(a){if(null===a&&(ib={},jb={}),h(a)&&c(a))for(var b in a)a.hasOwnProperty(b)&&(ib[b]=jb[b]=a[b]);return ib}a.template=a.template||{},a.template.version="0.3.0",a.template.errors={TEMPLATE_STRING_NO_ELEMENT:"Error in soma.template, a string template requirement a second parameter: an element target - soma.template.create('string', element)",TEMPLATE_NO_PARAM:"Error in soma.template, a template requires at least 1 parameter - soma.template.create(element)"};var gb="{{",hb="}}",ib={},jb={},kb=a.template.settings=a.template.settings||{};kb.autocreate=!0;var lb=kb.tokens={start:function(a){return h(a)&&""!==a&&(gb=m(a),n(a,!0)),gb},end:function(a){return h(a)&&""!==a&&(hb=m(a),n(a,!1)),hb}},mb=kb.attributes={skip:"data-skip",repeat:"data-repeat",src:"data-src",href:"data-href",show:"data-show",hide:"data-hide",cloak:"data-cloak",checked:"data-checked",disabled:"data-disabled",multiple:"data-multiple",readonly:"data-readonly",selected:"data-selected",template:"data-template",html:"data-html","class":"data-class"},nb=kb.vars={index:"$index",key:"$key",element:"$element",parentElement:"$parentElement",attribute:"$attribute",scope:"$scope"},ob=kb.events={};kb.eventsPrefix="data-";var pb="click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup focus blur change select selectstart scroll copy cut paste mousewheel keypress error contextmenu input textinput drag dragenter dragleave dragover dragend dragstart dragover drop load submit reset search resize beforepaste beforecut beforecopy";pb+=" touchstart touchend touchmove touchenter touchleave touchcancel gesturestart gesturechange gestureend";for(var qb=pb.split(" "),rb=-1,sb=qb.length;++rb<sb;)ob[kb.eventsPrefix+qb[rb]]=qb[rb];var tb={sequence:null,token:null,expression:null,escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,trim:/^[\s+]+|[\s+]+$/g,repeat:/(.*)\s+in\s+(.*)/,func:/(.*)\((.*)\)/,params:/,\s+|,|\s+,\s+/,quote:/\"|\'/g,content:/[^.|^\s]/gm,depth:/..\//g,string:/^(\"|\')(.*)(\"|\')$/},ub=function(){if("object"!=typeof document)return void 0;for(var a=3,b=!1,c=document.createElement("div");!b;)c.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c.getElementsByTagName("i")[0]||(b=!0);return a>4?a:void 0}(),vb="object"!=typeof document?function(){}:document.documentElement.contains?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!!(d&&1===d.nodeType&&c.contains&&c.contains(d))}:document.documentElement.compareDocumentPosition?function(a,b){return b&&!!(16&a.compareDocumentPosition(b))}:function(a,b){for(;b=b.parentNode;)if(b===a)return!0;return!1},wb=function(a){function b(a){var b=c(a);return b._parent=d,d._children.push(b),b}function c(a){var c=a||{};return c._parent=null,c._children=[],c._createChild=function(){return d=c,b.apply(c,arguments)},c}var d;return c(a)},xb=function(a,b){this.element=a,this.scope=b,this.attributes=null,this.value=null,this.interpolation=null,this.invalidate=!1,this.skip=!1,this.repeater=null,this.isRepeaterDescendant=!1,this.isRepeaterChild=!1,this.parent=null,this.children=[],this.childrenRepeater=[],this.previousSibling=null,this.nextSibling=null,this.template=null,this.eventHandlers={},this.html=!1,f(this.element)&&(this.value=this.element.nodeValue,this.interpolation=new zb(this.value,this,void 0))};xb.prototype={toString:function(){return"[object Node]"},dispose:function(){this.clearEvents();var a,b;if(this.children)for(a=0,b=this.children.length;b>a;a++)this.children[a].dispose();if(this.childrenRepeater)for(a=0,b=this.childrenRepeater.length;b>a;a++)this.childrenRepeater[a].dispose();if(this.attributes)for(a=0,b=this.attributes.length;b>a;a++)this.attributes[a].dispose();this.interpolation&&this.interpolation.dispose(),this.element=null,this.scope=null,this.attributes=null,this.value=null,this.interpolation=null,this.repeater=null,this.parent=null,this.children=null,this.childrenRepeater=null,this.previousSibling=null,this.nextSibling=null,this.template=null,this.eventHandlers=null},getNode:function(a){var b;if(a===this.element)return this;if(this.childrenRepeater.length>0)for(var c=0,d=this.childrenRepeater.length;d>c;c++)if(b=this.childrenRepeater[c].getNode(a))return b;for(var e=0,f=this.children.length;f>e;e++)if(b=this.children[e].getNode(a))return b;return null},getAttribute:function(a){if(this.attributes)for(var b=0,c=this.attributes.length;c>b;b++){var d=this.attributes[b];if(d.interpolationName&&d.interpolationName.value===a)return d}},update:function(){if(!l(this)){if(h(this.interpolation)&&this.interpolation.update(),h(this.attributes))for(var a=0,b=this.attributes.length;b>a;a++)this.attributes[a].update();O(this)}},invalidateData:function(){if(!l(this)){this.invalidate=!0;var a,b;if(this.attributes)for(a=0,b=this.attributes.length;b>a;a++)this.attributes[a].invalidate=!0;for(a=0,b=this.childrenRepeater.length;b>a;a++)this.childrenRepeater[a].invalidateData();for(a=0,b=this.children.length;b>a;a++)this.children[a].invalidateData()}},addEvent:function(a,b,c){if(!this.repeater){this.eventHandlers[a]&&this.removeEvent(a);var d=this.scope,e=this,f=function(a){var f=new Ab(b,e,c),g=f.getValue(d,!0),h=f.getValue(d,!1,!0);h.unshift(a),g&&g.apply(null,h)};this.eventHandlers[a]=f,V(this.element,a,f)}},removeEvent:function(a){W(this.element,a,this.eventHandlers[a]),this.eventHandlers[a]=null,delete this.eventHandlers[a]},clearEvents:function(){if(this.eventHandlers)for(var a in this.eventHandlers)this.eventHandlers.hasOwnProperty(a)&&this.removeEvent(a);if(this.children)for(var b=0,c=this.children.length;c>b;b++)this.children[b].clearEvents();if(this.childrenRepeater)for(var d=0,e=this.childrenRepeater.length;e>d;d++)this.childrenRepeater[d].clearEvents()},render:function(){if(!l(this)){if(this.invalidate&&(this.invalidate=!1,f(this.element)&&(this.value=this.parent&&this.parent.html?this.parent.element.innerHTML=this.interpolation.render():this.element.nodeValue=this.interpolation.render())),this.attributes)for(var a=0,b=this.attributes.length;b>a;a++)this.attributes[a].render();this.repeater?Q(this):P(this)}}};var yb=function(a,b,c){this.name=a,this.value=b,this.node=c,this.interpolationName=new zb(this.name,null,this),this.interpolationValue=new zb(this.value,null,this),this.invalidate=!1};yb.prototype={toString:function(){return"[object Attribute]"},dispose:function(){this.interpolationName&&this.interpolationName.dispose(),this.interpolationValue&&this.interpolationValue.dispose(),this.interpolationName=null,this.interpolationValue=null,this.node=null,this.name=null,this.value=null,this.previousName=null},update:function(){this.node.repeater||(this.interpolationName.update(),this.interpolationValue.update())},render:function(){function a(a,b,c){"value"===a&&void 0!==c.element.value?e.value=b:7===ub&&"class"===a?e.className=b:e.setAttribute(a,b)}function b(a,b){i(a)?e.setAttribute(b,b):e.removeAttribute(b)}function c(a){e.setAttribute("src",a)}function d(a){e.setAttribute("href",a)}if(!this.node.repeater){var e=this.node.element;if(this.invalidate&&(this.invalidate=!1,this.previousName=this.name,this.name=h(this.interpolationName.render())?this.interpolationName.render():this.name,this.value=h(this.interpolationValue.render())?this.interpolationValue.render():this.value,this.name===mb.src?c(this.value):this.name===mb.href?d(this.value):((7!==ub||7===ub&&!this.node.isRepeaterChild)&&this.node.element.removeAttribute(this.interpolationName.value),this.previousName&&(7===ub&&"class"===this.previousName?this.node.element.className="":(7!==ub||7===ub&&!this.node.isRepeaterChild)&&this.node.element.removeAttribute(this.previousName)),a(this.name,this.value,this.node))),this.name===mb["class"]){var f,g,j,k,l;try{f=JSON.parse(this.value)}catch(m){throw new Error("Error, the value of a data-class attribute must be a valid JSON: "+this.value)}for(g in f)j=f[g],l=j?i(j):!1,k=j?i(j):!1,l?this.node.element.classList.add(g):v(this.node.element,g)}if("class"===this.name&&-1!==this.value.indexOf(kb.attributes.cloak)&&v(this.node.element,kb.attributes.cloak),this.name===mb.hide){var n=i(this.value);a(this.name,n,this.node),e.style.display=n?"none":""}if(this.name===mb.show){var n=i(this.value);a(this.name,n,this.node),e.style.display=n?"":"none"}if(this.name===mb.checked&&(b(this.value,"checked"),a(this.name,i(this.value)?!0:!1,this.node),e.checked=i(this.value)?!0:!1),this.name===mb.disabled&&(b(this.value,"disabled"),a(this.name,i(this.value)?!0:!1,this.node)),this.name===mb.multiple&&(b(this.value,"multiple"),a(this.name,i(this.value)?!0:!1,this.node)),this.name===mb.readonly){var n=i(this.value);7===ub?e.readOnly=n?!0:!1:b(this.value,"readonly"),a(this.name,n?!0:!1,this.node)}this.name===mb.selected&&(b(this.value,"selected"),a(this.name,i(this.value)?!0:!1,this.node))}}};var zb=function(a,b,c){this.value=b&&!f(b.element)?o(a):a,this.node=b,this.attribute=c,this.sequence=[],this.expressions=[];var d=this.value.match(tb.sequence);if(d){for(var e=0,g=d.length;g>e;e++)if(d[e].match(tb.token)){var h=new Ab(r(d[e]),this.node,this.attribute);this.sequence.push(h),this.expressions.push(h)}else this.sequence.push(d[e]);q(this.sequence)}};zb.prototype={toString:function(){return"[object Interpolation]"},dispose:function(){if(this.expressions)for(var a=0,b=this.expressions.length;b>a;a++)this.expressions[a].dispose();this.value=null,this.node=null,this.attribute=null,this.sequence=null,this.expressions=null},update:function(){for(var a=-1,b=this.expressions.length;++a<b;)this.expressions[a].update()},render:function(){var a="";if(this.sequence)for(var b=0,c=this.sequence.length;c>b;b++){var d="";d=j(this.sequence[b])?this.sequence[b].value:this.sequence[b],h(d)||(d=""),a+=d}return a}};var Ab=function(a,b,c){h(a)&&(this.pattern=a,this.isString=tb.string.test(a),this.node=b,this.attribute=c,this.value=this.isString?this.pattern:void 0,this.isString?(this.isFunction=!1,this.depth=null,this.path=null,this.params=null):(this.isFunction=k(this.pattern),this.depth=F(this.pattern),this.path=D(this.pattern),this.params=this.isFunction?E(this.pattern.match(tb.func)[2]):null))};Ab.prototype={toString:function(){return"[object Expression]"},dispose:function(){this.pattern=null,this.node=null,this.attribute=null,this.path=null,this.params=null,this.value=null},update:function(){var a=this.node;if(!a&&this.attribute&&(a=this.attribute.node),a||!a.scope){var b=this.getValue(a.scope);b=z(this,b),this.value!==b&&(this.value=b,(this.node||this.attribute).invalidate=!0)}},getValue:function(a,b,c){var d=this.node;!d&&this.attribute&&(d=this.attribute.node);var e={};return d&&(e[nb.element]=d.element,d.element&&(e[nb.parentElement]=d.element.parentNode)),e[nb.attribute]=this.attribute,e[nb.scope]=a,C(a,this.pattern,this.path,this.params,b,c,void 0,e)}};var Bb=new w("st"),Cb=function(a){this.watchers=new w("stw"),this.node=null,this.scope=null,this.compile(a)};Cb.prototype={toString:function(){return"[object Template]"},compile:function(a){a&&(this.element=a),this.node&&this.node.dispose(),this.node=L(this,this.element),this.node.root=!0,this.scope=this.node.scope},update:function(a){h(a)&&M(this.node.scope,a),this.node&&this.node.update()},render:function(a){this.update(a),this.node&&this.node.render()},invalidate:function(){this.node&&this.node.invalidateData()},watch:function(a,b){(d(a)||e(a))&&g(b)&&this.watchers.put(a,b)},unwatch:function(a){this.watchers.remove(a)},clearWatchers:function(){this.watchers.dispose()},clearEvents:function(){this.node.clearEvents()},getNode:function(a){return this.node.getNode(a)},dispose:function(){Bb.remove(this.element),this.watchers&&this.watchers.dispose(),this.node&&this.node.dispose(),this.element=null,this.watchers=null,this.node=null}},V.guid=1,X.preventDefault=function(){this.returnValue=!1},X.stopPropagation=function(){this.cancelBubble=!0};var Db,Eb,Fb=[];if("object"==typeof document){var Eb=function(){function a(a){for(l=1;a=c.shift();)a()}var b,c=[],d=!1,e=document,f=e.documentElement,g=f.doScroll,h="DOMContentLoaded",i="addEventListener",j="onreadystatechange",k="readyState",l=/^loade|c/.test(e[k]);return e[i]&&e[i](h,b=function(){e.removeEventListener(h,b,d),a()},d),g&&e.attachEvent(j,b=function(){/^c/.test(e[k])&&(e.detachEvent(j,b),a())}),g?function(a){self!=top?l?a():c.push(a):function(){try{f.doScroll("left")}catch(b){return setTimeout(function(){Eb(a)},50)}a()}()}:function(a){l?a():c.push(a)}}();if(kb.autocreate){var Gb=function(b){for(var c=b?b.firstChild:document.body;c;){if(1===c.nodeType){Gb(c);var d=c.getAttribute(mb.template);if(d){var e=new Function("return "+d+";"),f=e();g(f)&&a.template.bootstrap(d,c,f)}}c=c.nextSibling}};Eb(Gb)}}lb.start(gb),lb.end(hb),a.plugins=a.plugins||{};var Hb=function(instance,injector){instance.constructor.prototype.createTemplate=function(b,c){if(!b||"function"!=typeof b)throw new Error("Error creating a template, the first parameter must be a function.");if(c&&e(c)){var d=a.template.create(c);for(var f in d)"function"==typeof d[f]&&(b.prototype[f]=d[f].bind(d));b.prototype.render=d.render.bind(d);var g=injector.createChild();return g.mapValue("template",d),g.mapValue("scope",d.scope),g.mapValue("element",d.element),g.createInstance(b)}return null},a.template.bootstrap=function(a,b,c){instance.createTemplate(c,b)}};a.plugins&&a.plugins.add&&a.plugins.add(Hb),a.template.Plugin=Hb,a.template.create=cb,a.template.get=db,a.template.renderAll=eb,a.template.helpers=fb,a.template.bootstrap=bb,a.template.addEvent=V,a.template.removeEvent=W,a.template.parseEvents=Y,a.template.clearEvents=ab,a.template.ready=Eb,"function"==typeof define&&"undefined"!=typeof define.amd&&define("soma-template",a.template),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=a.template),"undefined"!=typeof exports&&(exports=a.template)}(this.soma=this.soma||{});